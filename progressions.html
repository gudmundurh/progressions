<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Progressions</title>

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
	<script type="text/javascript" src="scripts/utilities.js"></script>
	<script type="text/javascript" src="scripts/rendering.js"></script>
	<script type="text/javascript" src="scripts/progressions.js"></script>
	<script type="text/javascript" src="scripts/mandolindb.js"></script>
	
	<link rel="stylesheet" type="text/css" href="css/blueprint.css" media="screen, projection">
	<style type="text/css">
	    ul#majorChords {  
	        list-style-type: none;
	        overflow: auto;
            margin-left: 0;
            margin-top: 1.5em;
	    }
	    
	    ul#majorChords li {
	        float: left;
	        margin: 0 1em 0 0;
	        padding: 0;
	    }
	</style>
</head>

<body>
    <div class="container">
        <ul id="majorChords"></ul>
        
        <h1>Chords</h1>
        
        <div id="primaryChords"></div>
        
        <h2>Accompanying minor chords</h2>
            
        <div id="secondaryChords"></div>
    </div>
    
    <script type="text/javascript">
        $(function() {
            $('#majorChords').html(
                $.map(Notes.getAll(), function(note) {
                    return '<li><a href="#" rel="' + note.name + '">' + note.name + '</a></li>' 
                }).join('')
            ).find('a').bind('click', function() {
                drawMajorChordProgressions(this.rel);
                drawMinorChordProgressions(this.rel);
                return false;
            });
                        

            function drawMajorChordProgressions(noteName) {
                var chords = MandolinChordDb.getMajorChordProgression(Notes.get(noteName));
                drawChordProgressions('primaryChords', chords);
            }
            
            function drawMinorChordProgressions(noteName) {
                var chords = MandolinChordDb.getMinorChordProgression(Notes.get(noteName));
                drawChordProgressions('secondaryChords', chords);
            }
            
            function drawChordProgressions(containerId, chords) {
                var container = $('#' + containerId);
                for (var i = 0; i < chords.length; i++) {
                    var chordContainer = container.find('div').eq(i);
                    chordContainer.find('h2').html(chords[i].toString());
                    new ChordRenderer(chordContainer.find('canvas').get(0)).renderChord(chords[i].getForms()[0]);
                }
            }
            
            
            function initChordContainer(containerId) {
                var container = $('#' + containerId);
                for (var i = 0; i < 3; i++) {
                    container.append('<div class="span-8"><h2></h2><canvas width="300" height="150"></canvas></div>');
                }
                container.find('div:last').addClass('last');
            }
            initChordContainer('primaryChords');
            initChordContainer('secondaryChords');
            
            drawMajorChordProgressions('C');
            drawMinorChordProgressions('C');

        });
    </script>
</body>
</html>